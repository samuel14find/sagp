@model FuncionarioEditViewModel

@{
    ViewBag.Title = "Carreira do Funcionário";
}

<h2>Carreira do Funcionário</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Criação do Carreira do Funcionário</h4>
        <hr />
        <div class="form-group">
            @Html.LabelFor(model => model.IdentificadorFuncionarioCarreira, htmlAttributes: new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.IdentificadorFuncionarioCarreira, new { htmlAttributes = new { @class = "form-control", @readonly="readonly" } })
                @Html.ValidationMessageFor(model => model.IdentificadorFuncionarioCarreira, "", new { @class = "text-danger" })
            </div>
        </div>

        <div  class="form-group">
            @Html.LabelFor(model => model.NomeFuncionario, htmlAttributes: new { @class = "control-label col-md-2" })

            <div class="col-md-10">
                @Html.EditorFor(model => model.NomeFuncionario, new { htmlAttributes = new { @class = "form-control", @autofocus = "autofocus" } })
                @Html.ValidationMessageFor(model => model.NomeFuncionario, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(x => Model.SelectedCarreiraIso5, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-5">
                @Html.DropDownListFor(x => Model.SelectedCarreiraIso5, new SelectList(Model.Carreiras, "Value", "Text"), htmlAttributes: new { @class = "form-control", id = "Carreira"})
                @Html.ValidationMessageFor(x => x.SelectedCarreiraIso5, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(x => Model.SelectedProgressaoCode, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-5">
                @Html.DropDownListFor(x => Model.SelectedProgressaoCode, new SelectList(Model.Progressoes, "Value", "Text"), htmlAttributes: new { @class = "form-control", @id = "Progressao" })
                @Html.ValidationMessageFor(x => x.SelectedProgressaoCode, "", new { @class = "text-danger" })
            </div>
        </div>
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Criar Carreira" class="btn btn-primary" />
                @await Component.InvokeAsync("FuncionarioCarreiraMenu")
            </div>
        </div>
        
    </div>

    @section Scripts{
        <script type="text/javascript">
          $('#Carreira').change(function () {
                var selectedCarreira = $("#Carreira").val();
                var selectedProgressao = $('#Progressao');
                selectedProgressao.empty();
                if (selectedCarreira != null && selectedCarreira != '') {
                    $.getJSON('@Url.Action("GetProgressoes")', { iso5: selectedCarreira }, function (progressoes) {
                        if (progressoes != null && !jQuery.isEmptyObject(progressoes))
                        {
                            console.log(progressoes[0].text);
                            selectedProgressao.append($('<option/>', {
                                value: null,
                                text: ""
                            }));
                            $.each(progressoes, function (index, p) {
                                console.log(p)
                                selectedProgressao.append($('<option/>', {
                                    value: p.value,
                                    text: p.text
                                }));
                            });
                        };
                    });
                }
            });
        </script>
    }
}